{
  "tables": [
    {
      "tableName": "job_executions",
      "generateId": false,
      "fromModuleVersion": "1.0",
      "withMetadata": false,
      "pkColumnName": "_id",
      "index": [
        {
          "fieldName": "id",
          "tOps": "ADD"
        }
      ]
    },
    {
      "tableName": "job_execution_source_chunks",
      "generateId": false,
      "fromModuleVersion": "1.0",
      "withMetadata": false,
      "pkColumnName": "_id",
      "index": [
        {
          "fieldName": "id",
          "tOps": "ADD"
        },
        {
          "fieldName": "jobExecutionId",
          "tOps": "ADD"
        }
      ],
      "foreignKeys": [
        {
          "fieldName": "jobExecutionId",
          "targetTable": "job_executions",
          "tOps": "ADD"
        }
      ]
    }
  ],
  "scripts": [
    {
      "run": "after",
      "snippet": "CREATE SEQUENCE IF NOT EXISTS job_execution_hr_id_sequence INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 9223372036854775807 CACHE 1;",
      "fromModuleVersion": "2.0"
    },
    {
      "run": "after",
      "snippet": "CREATE OR REPLACE FUNCTION get_processing_is_completed_and_has_error(jobExecId uuid) RETURNS TABLE (completed boolean) AS $result$ BEGIN RETURN QUERY SELECT count(_id) = (SELECT count(_id) FROM job_execution_source_chunks WHERE (jsonb->>'jobExecutionId')::uuid = jobExecId) as completed FROM job_execution_source_chunks WHERE (jsonb->>'jobExecutionId')::uuid = jobExecId AND jsonb->>'state' IN ('COMPLETED', 'ERROR') UNION ALL (SELECT 0 < (SELECT count(_id) FROM job_execution_source_chunks WHERE (jsonb->>'jobExecutionId')::uuid = jobExecId AND jsonb->>'state' = 'ERROR') as error); END; $result$ LANGUAGE plpgsql;",
      "fromModuleVersion": "2.0"
    }
  ]
}
